<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: controllers/recipeControllers.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: controllers/recipeControllers.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const db = require("../db");

/**
 * Récupère toutes les recettes.
 *
 * @param {Object} req - Objet de requête Express
 * @param {Object} res - Objet de réponse Express
 * @returns {Promise&lt;void>} - Retourne un JSON contenant toutes les recettes disponibles sur l'application.
 * @example
 * // GET /api/v1/recipes
 */
exports.getAllRecipes = async (req, res) => {
  try {
    const recipes = await db.many("SELECT * FROM recipes");

    res.json(recipes);
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
};

/**
 * Récupère une recette grâce à son ID
 *
 * @param {Object} req - Objet de requête Express
 * @param {Object} res - Objet de réponse Express
 * @returns {Promise&lt;void>} - Retourne un JSON contenant les informations de la recettes choisie.
 * @example
 * // GET /api/v1/recipes/1
 *
 * // Retourne les informations de la recette correspondant à l'id 1
 */
exports.getOneRecipe = async (req, res) => {
  try {
    const { id } = req.params;

    const recipe = await db.oneOrNone(
      "SELECT * FROM recipes WHERE id_recipe = $1",
      id
    );

    if (!recipe) {
      return res.status(404).json({ message: "Recette introuvable" });
    }

    res.status(200).json(recipe);
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
};

/**
 * Crée une nouvelle recette.
 *
 * @param {Object} req - Objet de requête Express
 * @param {Object} res - Objet de réponse Express
 * @returns {Promise&lt;void>} - Retourne un JSON contenant un message de confirmation de création ainsi que les informations de la recette.
 * @example
 * // POST /api/v1/recipes/
 * // Headers : `Authorization: Bearer &lt;votre_jeton_jwt>`
 * {
 *  "name": "Recette de test",
 *  "preparationTime": 20,
 *  "cookingTime": 12,
 *  "restingTime": 0,
 *  "instructions": {
 *    "steps": [
 *      "Pour cuire les œufs durs, dépose-les dans une casserole et recouvre-les d’eau froide, à environ 2,5 cm au-dessus de leur hauteur. Porte l’eau à ébullition, puis retire la casserole du feu. Couvre et laisse reposer 10 à 12 minutes selon la taille des œufs. Égoutte ensuite les œufs et plonge-les dans de l’eau froide pour stopper la cuisson. Écale-les soigneusement.",
 *      "Coupe les œufs durs en deux dans le sens de la longueur et retire délicatement les jaunes. Dépose-les dans un bol.",
 *      "Ajoute la mayonnaise, la relish de cornichons et la moutarde. Écrase le tout à la fourchette jusqu’à obtenir une texture lisse. Assaisonne de sel et de poivre selon ton goût, puis ajuste la quantité de mayonnaise ou de moutarde si nécessaire.",
 *      "À l’aide d’une cuillère ou d’une poche à douille, garnis les blancs d’œufs avec le mélange. Saupoudre de paprika juste avant de servir."
 *    ]
 *  },
 *  "nutritionalValues": {
 *    "totalFat": {
 *      "name": "Matières grasses totales",
 *      "quantity": 10,
 *      "unit": "g"
 *    },
 *    "saturatedFat": {
 *      "name": "Acides gras saturés",
 *      "quantity": 4,
 *      "unit": "g"
 *    },
 *    "cholesterol": {
 *      "name": "Cholestérol",
 *      "quantity": 53,
 *      "unit": "mg"
 *    },
 *    "sodium": {
 *      "name": "Sodium",
 *      "quantity": 85,
 *      "unit": "mg"
 *    },
 *    "totalCarbohydrate": {
 *      "name": "Glucides totaux",
 *      "quantity": 15,
 *      "unit": "g"
 *    },
 *    "dietaryFiber": {
 *      "name": "Fibres alimentaires",
 *      "quantity": 1,
 *      "unit": "g"
 *    },
 *    "totalSugars": {
 *      "name": "Sucres totaux",
 *      "quantity": 10,
 *      "unit": "g"
 *    },
 *    "protein": {
 *      "name": "Protéines",
 *      "quantity": 10,
 *      "unit": "g"
 *    },
 *    "calcium": {
 *      "name": "Calcium",
 *      "quantity": 19,
 *      "unit": "mg"
 *    },
 *    "iron": {
 *      "name": "Fer",
 *      "quantity": 1,
 *      "unit": "mg"
 *    },
 *    "potassium": {
 *      "name": "Potassium",
 *      "quantity": 183,
 *      "unit": "mg"
 *    },
 *    "calories": {
 *      "name": "Calories",
 *      "quantity": 193,
 *      "unit": "kcal"
 *    }
 *  },
 *  "servings": 10
 * }
 */
exports.addRecipe = async (req, res) => {
  try {
    const {
      name,
      preparationTime,
      cookingTime,
      restingTime,
      instructions,
      nutritionalValues,
      servings,
    } = req.body;

    const existingRecipe = await db.oneOrNone(
      "SELECT * FROM recipes WHERE name_recipe ILIKE $1",
      name
    );

    if (existingRecipe != null) {
      return res
        .status(409)
        .json({ message: "Ce nom de recette est déjà utilisé" });
    }

    const totalTime =
      parseInt(preparationTime) + parseInt(cookingTime) + parseInt(restingTime);

    const recipeCreated = await db.one(
      `INSERT INTO recipes(name_recipe, preparation_time, cooking_time, resting_time, instructions, total_time, nutritional_values_recipe, servings_recipe) 
      VALUES ($1, $2, $3, $4, $5, $6, $7, $8) 
      RETURNING *`,
      [
        name,
        preparationTime,
        cookingTime,
        restingTime,
        instructions,
        totalTime,
        nutritionalValues,
        servings,
      ]
    );

    res
      .status(201)
      .json({ message: "Recette ajoutée avec succès", recipeCreated });
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
};

/**
 * Met à jour les informations d'une recette donnée
 *
 * @param {Object} req - Objet de requête Express
 * @param {Object} res - Objet de réponse Express
 * @returns {Promise&lt;void>} - Retourne un JSON contenant un message de confirmation de mise à jour ainsi que les informations de la recette.
 * @example
 * // PUT /api/v1/recipes/1
 * // Headers : `Authorization: Bearer &lt;votre_jeton_jwt>`
 * {
 *  "name": "Recette de test renommée"
 * }
 */
exports.updateRecipe = async (req, res) => {
  try {
    const { id } = req.params;

    const existingRecipe = await db.oneOrNone(
      "SELECT * FROM recipes WHERE id_recipe = $1",
      id
    );

    if (!existingRecipe) {
      return res.status(404).json({ message: "Recette introuvable" });
    }

    const {
      name,
      preparationTime,
      cookingTime,
      restingTime,
      instructions,
      nutritionalValues,
      servings,
    } = req.body;

    const existingRecipeName = await db.oneOrNone(
      "SELECT * FROM recipes WHERE name_recipe ILIKE $1 AND id_recipe != $2",
      [name, id]
    );

    if (existingRecipeName) {
      return res
        .status(409)
        .json({ message: "Ce nom de recette n'est pas disponible" });
    }

    const totalTime =
      (preparationTime
        ? parseInt(preparationTime)
        : parseInt(existingRecipe.preparation_time)) +
      (cookingTime
        ? parseInt(cookingTime)
        : parseInt(existingRecipe.cooking_time)) +
      (restingTime
        ? parseInt(restingTime)
        : parseInt(existingRecipe.resting_time));

    const recipeUpdated = await db.one(
      `UPDATE recipes
        SET
          name_recipe = $1,
          preparation_time = $2,
          cooking_time = $3,
          resting_time = $4,
          instructions = $5,
          total_time = $6,
          "nutritional_values_recipe" = $7,
          servings_recipe = $8
        WHERE id_recipe = $9
        RETURNING *`,
      [
        name ?? existingRecipe.name_recipe,
        preparationTime ?? existingRecipe.preparation_time,
        cookingTime ?? existingRecipe.cooking_time,
        restingTime ?? existingRecipe.resting_time,
        instructions ?? existingRecipe.instructions,
        totalTime,
        nutritionalValues ?? existingRecipe.nutritional_values_recipe,
        servings ?? existingRecipe.servings_recipe,
        id,
      ]
    );

    res.status(200).json({ message: "Recette mise à jour", recipeUpdated });
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
};

/**
 * Supprime une recette de la base de données
 *
 * @param {Object} req - Objet de requête Express
 * @param {Object} res - Objet de réponse Express
 * @returns {Promise&lt;void>} - Retourne un code 204 confirmant la délétion.
 * @example
 * // DELETE /api/v1/recipes/1
 * // Headers : `Authorization: Bearer &lt;votre_jeton_jwt>`
 */
exports.deleteRecipe = async (req, res) => {
  try {
    const { id } = req.params;

    const deletedRecipe = await db.result(
      `DELETE FROM recipes WHERE id_recipe = $1`,
      id
    );

    if (deletedRecipe.rowCount === 0) {
      return res.status(404).json({ message: "Recette introuvable" });
    }

    res.status(204).json({ message: "Recette supprimée" });
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
};

/**
 * Permet de rechercher des recettes par leur nom.
 *
 * @param {Object} req - Objet de requête Express
 * @param {Object} res - Objet de réponse Express
 * @returns {Promise&lt;void>} - Renvoie les informations des recettes correspondant à la recherche
 * @example
 * // GET /api/v1/recipes/search/tartinade-de-saumon
 */
exports.searchRecipes = async (req, res) => {
  try {
    const { search } = req.params;

    const splitSearch = search
      .split("+")
      .map((word) => word.trim())
      .filter(Boolean);

    const conditions = splitSearch
      .map((_, idx) => `name_recipe ILIKE $${idx + 1}`)
      .join(" AND ");

    const values = splitSearch.map((word) => `%${word}%`);

    const searchResult = await db.any(
      `SELECT * FROM recipes WHERE ${conditions}`,
      values
    );

    res.status(200).json(searchResult);
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addBannedIngredientToUser">addBannedIngredientToUser</a></li><li><a href="global.html#addDiet">addDiet</a></li><li><a href="global.html#addIngredient">addIngredient</a></li><li><a href="global.html#addRecipe">addRecipe</a></li><li><a href="global.html#addTag">addTag</a></li><li><a href="global.html#addUstensil">addUstensil</a></li><li><a href="global.html#adminMiddleware">adminMiddleware</a></li><li><a href="global.html#authMiddleware">authMiddleware</a></li><li><a href="global.html#deleteBannedIngredientFromUser">deleteBannedIngredientFromUser</a></li><li><a href="global.html#deleteDiet">deleteDiet</a></li><li><a href="global.html#deleteIngredient">deleteIngredient</a></li><li><a href="global.html#deleteRecipe">deleteRecipe</a></li><li><a href="global.html#deleteReview">deleteReview</a></li><li><a href="global.html#deleteTag">deleteTag</a></li><li><a href="global.html#deleteUser">deleteUser</a></li><li><a href="global.html#deleteUstensil">deleteUstensil</a></li><li><a href="global.html#forgotPass">forgotPass</a></li><li><a href="global.html#getAllCategoriesAndRecipes">getAllCategoriesAndRecipes</a></li><li><a href="global.html#getAllDiets">getAllDiets</a></li><li><a href="global.html#getAllIngredients">getAllIngredients</a></li><li><a href="global.html#getAllRecipes">getAllRecipes</a></li><li><a href="global.html#getAllRecipesFromCategory">getAllRecipesFromCategory</a></li><li><a href="global.html#getAllTags">getAllTags</a></li><li><a href="global.html#getAllUsers">getAllUsers</a></li><li><a href="global.html#getAllUstensils">getAllUstensils</a></li><li><a href="global.html#getBannedIngredientsFromUser">getBannedIngredientsFromUser</a></li><li><a href="global.html#getIngrdientsFromRecipe">getIngrdientsFromRecipe</a></li><li><a href="global.html#getOneRecipe">getOneRecipe</a></li><li><a href="global.html#getOneUser">getOneUser</a></li><li><a href="global.html#getTagsFromRecipe">getTagsFromRecipe</a></li><li><a href="global.html#getUstensilsFromRecipe">getUstensilsFromRecipe</a></li><li><a href="global.html#linkCategoriesToRecipe">linkCategoriesToRecipe</a></li><li><a href="global.html#linkDietToTag">linkDietToTag</a></li><li><a href="global.html#linkDietToUser">linkDietToUser</a></li><li><a href="global.html#linkTagsToRecipe">linkTagsToRecipe</a></li><li><a href="global.html#linkUstensilsToRecipe">linkUstensilsToRecipe</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#postReview">postReview</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#resetPassMiddleware">resetPassMiddleware</a></li><li><a href="global.html#resetPassword">resetPassword</a></li><li><a href="global.html#searchDiet">searchDiet</a></li><li><a href="global.html#searchIngredients">searchIngredients</a></li><li><a href="global.html#searchRecipes">searchRecipes</a></li><li><a href="global.html#searchTag">searchTag</a></li><li><a href="global.html#searchUstensil">searchUstensil</a></li><li><a href="global.html#unlinkCategoryFromRecipe">unlinkCategoryFromRecipe</a></li><li><a href="global.html#unlinkDietFromTag">unlinkDietFromTag</a></li><li><a href="global.html#unlinkDietFromUser">unlinkDietFromUser</a></li><li><a href="global.html#unlinkTagToRecipe">unlinkTagToRecipe</a></li><li><a href="global.html#unlinkUstensilFromRecipe">unlinkUstensilFromRecipe</a></li><li><a href="global.html#updateDiet">updateDiet</a></li><li><a href="global.html#updateIngredient">updateIngredient</a></li><li><a href="global.html#updateRecipe">updateRecipe</a></li><li><a href="global.html#updateTag">updateTag</a></li><li><a href="global.html#updateUser">updateUser</a></li><li><a href="global.html#updateUstensil">updateUstensil</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Thu Oct 23 2025 14:09:35 GMT+0200 (heure d’été d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
